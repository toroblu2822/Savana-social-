
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Savana Social</title>
  <script src="https://unpkg.com/vue@3.4.15/dist/vue.global.prod.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-yellow-50 font-sans">
  <div id="app">
    
<div v-if="!user" class="bg-white p-6 rounded-xl shadow space-y-4 max-w-md mx-auto mt-20">
  <h2 class="text-xl font-bold text-center">ğŸŒ¿ Savana Social - Login</h2>
  <input v-model="email" type="email" placeholder="Email" class="w-full p-2 border rounded" />
  <input v-model="password" type="password" placeholder="Password" class="w-full p-2 border rounded" />
  <button @click="login" class="w-full bg-yellow-600 text-white p-2 rounded hover:bg-yellow-700">Login</button>
  <button @click="register" class="w-full bg-gray-200 text-gray-800 p-2 rounded">Registrati</button>
</div>

<div v-else class="max-w-2xl mx-auto p-4">
  <div class="bg-white p-4 rounded-xl shadow mb-4 flex justify-between items-center">
    <p class="font-bold">Benvenuto, {{ user.email }}</p>
    <button @click="logout" class="text-red-500">Esci</button>
  </div>

  <div class="bg-white p-4 rounded-xl shadow mb-4">
    <h3 class="font-semibold mb-2">ğŸŸ¢ Utenti Online</h3>
    <ul class="list-disc pl-4 text-sm">
      <li v-for="u in onlineUsers" :key="u">{{ u }}</li>
    </ul>
  </div>
</div>

  </div>
  
<script>
const { createApp } = Vue;

firebase.initializeApp({
  apiKey: "AIzaSyAjBjhgwUd0P4EV7ZhsqCRHPFJQoASUKvc",
  authDomain: "savana-social.firebaseapp.com",
  projectId: "savana-social",
  storageBucket: "savana-social.firebasestorage.app",
  messagingSenderId: "1009203185830",
  appId: "1:1009203185830:web:14ca2c419caab2dfc40c67"
});

const db = firebase.firestore();
const auth = firebase.auth();

createApp({
  data() {
    return {
      email: '',
      password: '',
      user: null,
      onlineUsers: []
    };
  },
  mounted() {
    auth.onAuthStateChanged(user => {
      if (user) {
        this.user = user;
        db.collection("online").doc(user.uid).set({
          email: user.email,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        this.trackOnlineUsers();
      } else {
        this.user = null;
      }
    });
  },
  methods: {
    login() {
      auth.signInWithEmailAndPassword(this.email, this.password)
        .catch(err => alert(err.message));
    },
    register() {
      auth.createUserWithEmailAndPassword(this.email, this.password)
        .catch(err => alert(err.message));
    },
    logout() {
      if (this.user) {
        db.collection("online").doc(this.user.uid).delete();
      }
      auth.signOut();
    },
    trackOnlineUsers() {
      db.collection("online").onSnapshot(snapshot => {
        this.onlineUsers = snapshot.docs.map(doc => doc.data().email);
      });
    }
  }
}).mount('#app');
</script>

</body>
</html>
